#!/bin/bash
MIPS_CC='mips-linux-gnu-gcc'
MIPS_OBJCOPY='mips-linux-gnu-objcopy'
MIPS_OBJDUMP='mips-linux-gnu-objdump'
MIPS_CPPFLAGS='-W -Wall -O3 -fno-builtin -march=mips1 -mfp32'
MIPS_LDFLAGS='-nostdlib -Wl,-melf32btsmip -march=mips1 -nostartfiles -mno-check-zero-division -Wl,--gpsize=0 -static -Wl,-Bstatic -Wl,--build-id=none'

TESTS='../test/bin/*bin'
OUTPUT_FILE='../test/results.csv'

rm $OUTPUT_FILE
echo ""TestId","Instruction","Status","Author","Message"" >> $OUTPUT_FILE

for i in $TESTS
do
  TEST_NAME=${i##*/}
  TEST_NAME=${TEST_NAME%*.mips.bin}
  INSTRUCTION=${TEST_NAME%?}

  ./mips_simulator $i
  RETCODE=$?
  echo $RETCODE

  EXPECTED=3
  if [[ "$RETCODE" = "$EXPECTED" ]]
  then
    echo "Success"
    echo "$TEST_NAME,$INSTRUCTION,"Pass","faw18","Message"" >> $OUTPUT_FILE
  else
    echo "Failure"
    echo "$TEST_NAME,$INSTRUCTION,"Fail","faw18","Message"" >> $OUTPUT_FILE
  fi

done

#print CSV to STDOUT
